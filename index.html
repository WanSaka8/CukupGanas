<!doctype html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VocabSR - Enhanced Spaced Repetition</title>
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #1a1a2e;
      --bg-card: #16213e;
      --bg-glass: rgba(255, 255, 255, 0.05);
      --bg-glass-strong: rgba(255, 255, 255, 0.1);

      --accent-purple: #7c3aed;
      --accent-pink: #ec4899;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --accent-cyan: #06b6d4;
      --accent-yellow: #eab308;

      --text-primary: #ffffff;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;

      --border: rgba(255, 255, 255, 0.1);
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
      --radius: 12px;
      --radius-lg: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Animated Background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 20%, rgba(124, 58, 237, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
      z-index: -1;
      animation: backgroundFloat 20s ease-in-out infinite;
    }

    @keyframes backgroundFloat {

      0%,
      100% {
        transform: translate(0, 0) rotate(0deg);
      }

      33% {
        transform: translate(-20px, -20px) rotate(1deg);
      }

      66% {
        transform: translate(20px, -10px) rotate(-1deg);
      }
    }

    /* Sidebar Styles */
    .sidebar-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-toggle:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -400px;
      width: 380px;
      height: 100vh;
      background: rgba(16, 21, 62, 0.95);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--border);
      z-index: 1000;
      transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }

    .sidebar.open {
      left: 0;
    }



    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      backdrop-filter: blur(4px);
    }

    .sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Header Styles */
    .sidebar-header {
      padding: 25px;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      color: white;
      text-align: center;
    }

    .sidebar-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .sidebar-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Sidebar Sections */
    .sidebar-section {
      padding: 25px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-section h3 {
      color: var(--text-primary);
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-section h3 svg {
      width: 20px;
      height: 20px;
      color: var(--accent-cyan);
    }

    /* Main App */
    .app {
      max-width: 1000px;
      margin: 0 auto;
      padding: 30px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px 0;
    }

    h1 {
      font-size: 48px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
      letter-spacing: -1px;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 18px;
      font-weight: 400;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--bg-glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 25px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card.total::before {
      background: var(--accent-purple);
    }

    .stat-card.due::before {
      background: var(--accent-orange);
    }

    .stat-card.new::before {
      background: var(--accent-green);
    }

    .stat-card.studied::before {
      background: var(--accent-blue);
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 15px;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-card.total .stat-icon {
      background: rgba(124, 58, 237, 0.2);
      color: var(--accent-purple);
    }

    .stat-card.due .stat-icon {
      background: rgba(245, 158, 11, 0.2);
      color: var(--accent-orange);
    }

    .stat-card.new .stat-icon {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
    }

    .stat-card.studied .stat-icon {
      background: rgba(59, 130, 246, 0.2);
      color: var(--accent-blue);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Study Card */
    .study-container {
      max-width: 700px;
      margin: 0 auto;
    }

    .card-preview {
      height: 350px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-lg);
      background: var(--bg-glass);
      border: 1px solid var(--border);
      perspective: 1000px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .card-preview::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(236, 72, 153, 0.1));
      z-index: -1;
    }

    .card {
      width: 90%;
      height: 85%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: var(--radius);
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      text-align: center;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .card-front {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
      color: white;
    }

    .card-back {
      background: linear-gradient(135deg, var(--accent-pink), var(--accent-orange));
      color: white;
      transform: rotateY(180deg);
    }

    .word {
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 15px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .translation {
      font-size: 22px;
      opacity: 0.95;
      font-weight: 400;
    }

    /* Buttons */
    .btn {
      background: var(--bg-glass);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 12px 24px;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      border: none;
      color: white;
    }

    /* Study Controls */
    .study-controls {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .card-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .rating-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 10px;
    }

    .rate-btn {
      padding: 20px 15px;
      border-radius: var(--radius);
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 90px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .rate-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .rate-btn:hover::before {
      transform: translateY(0);
    }

    .rate-btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .rate-btn small {
      font-size: 12px;
      opacity: 0.9;
      margin-top: 5px;
    }

    .again {
      background: linear-gradient(135deg, var(--accent-red), #dc2626);
    }

    .hard {
      background: linear-gradient(135deg, var(--accent-orange), #d97706);
    }

    .good {
      background: linear-gradient(135deg, var(--accent-green), #059669);
    }

    .easy {
      background: linear-gradient(135deg, var(--accent-blue), #1d4ed8);
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-input {
      width: 100%;
      padding: 15px 20px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--bg-glass);
      color: var(--text-primary);
      font-size: 16px;
      transition: all 0.3s ease;
      backdrop-filter: blur(20px);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-purple);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    /* Lists */
    .list-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: var(--radius);
      background: var(--bg-glass);
      border: 1px solid var(--border);
    }

    .list-item {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .list-item:hover {
      background: var(--bg-glass-strong);
    }

    .list-item:last-child {
      border-bottom: none;
    }

    /* Progress Bar */
    .progress-bar {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink));
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* Streak Counter */
    .streak-container {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      background: var(--bg-glass);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .streak-number {
      font-size: 48px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 5px;
    }

    .streak-label {
      color: var(--text-secondary);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Achievement Badges */
    .achievements {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }

    .badge {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      position: relative;
    }

    .badge:hover {
      transform: scale(1.1);
    }

    .badge.earned {
      background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
      color: white;
    }

    .badge.locked {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-muted);
    }

    /* Timer */
    .study-timer {
      text-align: center;
      margin: 20px 0;
      font-size: 18px;
      color: var(--accent-cyan);
      font-weight: 600;
    }

    /* Difficulty Indicator */
    .difficulty-indicator {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin: 15px 0;
    }

    .difficulty-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .difficulty-dot.active {
      background: var(--accent-orange);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100vw;
        left: -100vw;
      }

      .app {
        padding: 20px;
      }

      h1 {
        font-size: 36px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .card-preview {
        height: 280px;
      }

      .word {
        font-size: 32px;
      }

      .translation {
        font-size: 18px;
      }

      .rating-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Animations */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    .animate-in {
      animation: slideInUp 0.5s ease;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Dark Mode Toggle */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
      background: var(--bg-glass);
      border: 1px solid var(--border);
      color: var(--text-primary);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(20px);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    /* Review Page Styles */
    .review-category {
      background: var(--bg-glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 25px;
      box-shadow: var(--shadow);
    }

    .review-category h3 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .review-category .count-badge {
      background: rgba(255, 255, 255, 0.15);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .review-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }

    .review-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    .review-item-content {
      flex: 1;
    }

    .review-item .word {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .review-item .translation {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .review-item-actions {
      display: flex;
      gap: 10px;
    }

    .delete-btn {
      background: linear-gradient(135deg, var(--accent-red), #dc2626);
      border: none;
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
    }

    .delete-btn:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg);
    }



    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--accent-purple), var(--accent-pink));
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--accent-pink), var(--accent-purple));
    }

    /* Loading spinner animation */
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Base card untuk grammar */
    .grammar-category {
      border-radius: 12px;
      padding: 20px;
      color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Warna per tense */
    .grammar-category.present {
      background: linear-gradient(135deg, #16a34a, #4ade80);
    }

    .grammar-category.past {
      background: linear-gradient(135deg, #dc2626, #f87171);
    }

    .grammar-category.future {
      background: linear-gradient(135deg, #2563eb, #60a5fa);
    }

    /* Judul */
    .grammar-category h3 {
      margin: 0 0 10px 0;
      font-size: 20px;
      font-weight: bold;
    }

    /* Formula box */
    .formula {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 12px;
      border-radius: 8px;
      font-family: monospace;
      margin: 10px 0;
      display: inline-block;
    }

    /* Examples box */
    .examples {
      background: rgba(0, 0, 0, 0.25);
      padding: 10px 15px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .examples ul {
      margin: 0;
      padding-left: 20px;
    }

    .examples li {
      margin: 5px 0;
    }
  </style>
</head>

<body>
  <!-- Theme Toggle -->
  <button class="theme-toggle" id="themeToggle">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </button>

  <!-- Sidebar Toggle -->
  <button class="sidebar-toggle" id="sidebarToggle">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">VocabSR</div>
      <div class="sidebar-subtitle">Enhanced Learning Hub</div>
    </div>

    <div class="sidebar-content">
      <!-- Add Word Section -->
      <div class="sidebar-section">
        <h3>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
          Tambah Kata
        </h3>

        <div class="form-group">
          <input class="form-input" id="wordInput" placeholder="Masukkan kata atau gunakan format: kata,terjemahan" />
          <button class="btn btn-primary" id="addWordBtn" style="width: 100%; margin-top: 15px;">
            Tambah Kata
          </button>
        </div>

        <div id="errorMessage" style="color: var(--accent-red); font-size: 14px; margin-top: 10px; display: none;">
        </div>
      </div>

      <!-- Auto Translate Section -->
      <div class="sidebar-section">
        <h3>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 5h7M9 3v2a7 7 0 0 0 7 7h2M15 12a7 7 0 0 1-7 7H6"></path>
            <path d="M12 20l4-9 4 9"></path>
          </svg>
          Penerjemah Cepat
        </h3>

        <div class="form-group">
          <select id="translateDirection" class="form-input">
            <option value="en|id">Inggris → Indonesia</option>
            <option value="id|en">Indonesia → Inggris</option>
          </select>
        </div>

        <div class="form-group">
          <input class="form-input" id="translateInput" placeholder="Ketik kata/kalimat..." />
        </div>

        <div class="form-group">
          <textarea class="form-input" id="translateOutput" placeholder="Hasil terjemahan..." readonly></textarea>
        </div>
      </div>



      <!-- Search Section -->
      <div class="sidebar-section">
        <h3>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          Pencarian
        </h3>

        <div class="form-group">
          <input class="form-input" id="search" placeholder="Cari kata atau terjemahan..." />
        </div>

        <div class="list-container" id="wordList">
          <!-- Word list will be populated here -->
        </div>
      </div>

      <!-- Study Stats -->
      <div class="sidebar-section">
        <h3>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 3v18h18"></path>
            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"></path>
          </svg>
          Statistik
        </h3>

        <div class="streak-container">
          <div class="streak-number" id="streakCount">0</div>
          <div class="streak-label">Hari Berturut-turut</div>
        </div>

        <div class="progress-bar">
          <div class="progress-fill" id="dailyProgress" style="width: 0%"></div>
        </div>
        <div style="text-align: center; font-size: 14px; color: var(--text-secondary); margin-top: 5px;">
          Progress Hari Ini
        </div>

        <div class="achievements">
          <div class="badge locked" id="badge1" title="Belajar 7 hari berturut-turut">🔥</div>
          <div class="badge locked" id="badge2" title="Pelajari 50 kata">📚</div>
          <div class="badge locked" id="badge3" title="Akurasi 90%">⭐</div>
          <div class="badge locked" id="badge4" title="Streak 30 hari">👑</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="sidebar-section">
        <h3>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09">
            </path>
          </svg>
          Kontrol
        </h3>

        <div style="display: flex; flex-direction: column; gap: 15px;">
          <label for="fileInput" class="btn" style="text-align: center; cursor: pointer;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14,2 14,8 20,8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            Import CSV
          </label>
          <input id="fileInput" type="file" accept=".csv" style="display: none;">

          <button class="btn" id="exportBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-15"></path>
              <polyline points="7,10 12,15 17,10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Export CSV
          </button>

          <button class="btn" id="grammarBtn" style="background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple)); 
         color: white; 
         border: none; 
         width: 100%;">
            Belajar Pola
          </button>

          <button class="btn" id="reviewBtn"
            style="background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink)); color: white; border: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-4"></path>
              <rect x="13" y="1" width="8" height="8" rx="2"></rect>
            </svg>
            Review Mode
          </button>

          <button class="btn" id="resetBtn"
            style="background: linear-gradient(135deg, var(--accent-red), #dc2626); color: white; border: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3,6 5,6 21,6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Reset Data
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Page -->
  <div class="app review-app" id="reviewPage" style="display: none;">
    <header>
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
        <div>
          <h1 style="font-size: 36px; margin-bottom: 5px;">Review Kosakata</h1>
          <p class="subtitle">Tinjau dan kelola kosakata berdasarkan performa</p>
        </div>
        <button class="btn" id="backToMainBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
          Kembali
        </button>
      </div>
    </header>

    <!-- Review Categories -->
    <div id="reviewCategories"
      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px;">
      <!-- Categories will be populated here -->
    </div>
  </div>

  <!-- Grammar Page -->
  <div class="app grammar-app" id="grammarPage" style="display: none;">
    <header>
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px;">
        <div>
          <h1 style="font-size: 36px; margin-bottom: 5px;">Pola Kalimat Lengkap</h1>
          <p class="subtitle">12 Tenses Bahasa Inggris + Penjelasan Verb Forms</p>
        </div>
        <button class="btn" id="backToMainFromGrammar">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
          Kembali
        </button>
      </div>
    </header>

    <div style="margin-top:30px; display:grid; gap:20px;">

      <!-- Catatan Umum -->
      <div class="grammar-category">
        <h3>📌 Catatan Penting: Verb Forms</h3>
        <ul>
          <li><b>Verb 1 (V1)</b> → bentuk dasar, contoh: go, eat, study.</li>
          <li><b>Verb 2 (V2)</b> → bentuk lampau, contoh: went, ate, studied.</li>
          <li><b>Verb 3 (V3)</b> → past participle, contoh: gone, eaten, studied.</li>
          <li><b>Verb-ing</b> → bentuk continuous, contoh: going, eating, studying.</li>
        </ul>
      </div>

      <!-- PRESENT -->
      <div class="grammar-category">
        <h3>1. Present Simple</h3>
        <p><b>Formula:</b> S + V1 (s/es untuk he, she, it) + O</p>
        <p><b>Penggunaan:</b> kebiasaan, fakta umum, jadwal tetap.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>She <b>plays</b> piano every day. (habit)</li>
          <li>Water <b>boils</b> at 100°C. (fact)</li>
          <li>The train <b>leaves</b> at 7 p.m. (schedule)</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>2. Present Continuous</h3>
        <p><b>Formula:</b> S + am/is/are + V-ing + O</p>
        <p><b>Penggunaan:</b> aksi yang sedang berlangsung sekarang.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>I <b>am reading</b> a book right now.</li>
          <li>They <b>are studying</b> English.</li>
          <li>She <b>is cooking</b> dinner in the kitchen.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>3. Present Perfect</h3>
        <p><b>Formula:</b> S + has/have + V3 + O</p>
        <p><b>Penggunaan:</b> pengalaman, aksi yang sudah selesai tanpa waktu spesifik.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>I <b>have visited</b> Japan twice.</li>
          <li>She <b>has finished</b> her homework.</li>
          <li>We <b>have seen</b> that movie before.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>4. Present Perfect Continuous</h3>
        <p><b>Formula:</b> S + has/have + been + V-ing + O</p>
        <p><b>Penggunaan:</b> aksi yang dimulai di masa lalu dan masih berlangsung.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>She <b>has been studying</b> for three hours.</li>
          <li>I <b>have been waiting</b> since morning.</li>
          <li>They <b>have been playing</b> football all day.</li>
        </ul>
      </div>

      <!-- PAST -->
      <div class="grammar-category">
        <h3>5. Past Simple</h3>
        <p><b>Formula:</b> S + V2 + O</p>
        <p><b>Penggunaan:</b> kejadian selesai di masa lalu.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>They <b>went</b> to Bali last year.</li>
          <li>She <b>studied</b> hard yesterday.</li>
          <li>I <b>watched</b> a movie last night.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>6. Past Continuous</h3>
        <p><b>Formula:</b> S + was/were + V-ing + O</p>
        <p><b>Penggunaan:</b> aksi yang sedang berlangsung di masa lalu.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>I <b>was sleeping</b> when he called.</li>
          <li>They <b>were playing</b> football yesterday afternoon.</li>
          <li>She <b>was reading</b> a book at 9 p.m.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>7. Past Perfect</h3>
        <p><b>Formula:</b> S + had + V3 + O</p>
        <p><b>Penggunaan:</b> aksi yang selesai sebelum aksi lain di masa lalu.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>She <b>had left</b> before I arrived.</li>
          <li>They <b>had eaten</b> dinner when we came.</li>
          <li>I <b>had studied</b> English before moving abroad.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>8. Past Perfect Continuous</h3>
        <p><b>Formula:</b> S + had + been + V-ing + O</p>
        <p><b>Penggunaan:</b> aksi yang sudah berlangsung lama sampai titik tertentu di masa lalu.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>They <b>had been working</b> for hours before I joined.</li>
          <li>I <b>had been waiting</b> for two hours when she arrived.</li>
          <li>She <b>had been studying</b> all night before the exam.</li>
        </ul>
      </div>

      <!-- FUTURE -->
      <div class="grammar-category">
        <h3>9. Future Simple</h3>
        <p><b>Formula:</b> S + will + V1 + O</p>
        <p><b>Penggunaan:</b> prediksi, rencana, janji.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>I <b>will study</b> tonight.</li>
          <li>She <b>will call</b> you tomorrow.</li>
          <li>It <b>will rain</b> next week.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>10. Future Continuous</h3>
        <p><b>Formula:</b> S + will + be + V-ing + O</p>
        <p><b>Penggunaan:</b> aksi yang akan sedang berlangsung di masa depan.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>This time tomorrow, I <b>will be traveling</b> to Jakarta.</li>
          <li>She <b>will be studying</b> at 8 p.m.</li>
          <li>They <b>will be working</b> on the project next week.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>11. Future Perfect</h3>
        <p><b>Formula:</b> S + will + have + V3 + O</p>
        <p><b>Penggunaan:</b> aksi yang akan selesai sebelum waktu tertentu di masa depan.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>By next week, she <b>will have graduated</b>.</li>
          <li>I <b>will have finished</b> the book by tomorrow.</li>
          <li>They <b>will have arrived</b> before noon.</li>
        </ul>
      </div>

      <div class="grammar-category">
        <h3>12. Future Perfect Continuous</h3>
        <p><b>Formula:</b> S + will + have + been + V-ing + O</p>
        <p><b>Penggunaan:</b> aksi yang akan sudah berlangsung selama periode tertentu di masa depan.</p>
        <p><i>Examples:</i></p>
        <ul>
          <li>By 2025, I <b>will have been working</b> here for 10 years.</li>
          <li>She <b>will have been studying</b> for hours by the time you come.</li>
          <li>They <b>will have been living</b> in Jakarta for a decade.</li>
        </ul>
      </div>

    </div>
  </div>


  <!-- Main App -->
  <div class="app" id="mainApp">
    <!-- Header -->
    <header>
      <h1 class="animate-in">VocabSR</h1>
      <p class="subtitle animate-in">Master vocabulary with intelligent spaced repetition</p>
    </header>

    <!-- Stats Grid -->
    <div class="stats-grid animate-in">
      <div class="stat-card total">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
          </svg>
        </div>
        <div class="stat-value" id="totalCards">0</div>
        <div class="stat-label">Total Kata</div>
      </div>

      <div class="stat-card due">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12,6 12,12 16,14"></polyline>
          </svg>
        </div>
        <div class="stat-value" id="dueCards">0</div>
        <div class="stat-label">Perlu Review</div>
      </div>

      <div class="stat-card new">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </div>
        <div class="stat-value" id="newCards">0</div>
        <div class="stat-label">Kata Baru</div>
      </div>

      <div class="stat-card studied">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22,4 12,14.01 9,11.01"></polyline>
          </svg>
        </div>
        <div class="stat-value" id="studiedCards">0</div>
        <div class="stat-label">Dipelajari</div>
      </div>
    </div>

    <!-- Study Container -->
    <div class="study-container animate-in">
      <!-- Study Timer -->
      <div class="study-timer" id="studyTimer">00:00</div>

      <!-- Card Preview -->
      <div class="card-preview">
        <div class="card" id="studyCard">
          <div class="card-face card-front">
            <div class="word" id="frontText">Siap Belajar?</div>
            <div class="difficulty-indicator">
              <div class="difficulty-dot"></div>
              <div class="difficulty-dot"></div>
              <div class="difficulty-dot"></div>
              <div class="difficulty-dot"></div>
              <div class="difficulty-dot"></div>
            </div>
          </div>
          <div class="card-face card-back">
            <div class="word" id="backText"></div>
            <div class="translation" id="backTranslation"></div>
            <div class="difficulty-indicator">
              <div class="difficulty-dot active"></div>
              <div class="difficulty-dot active"></div>
              <div class="difficulty-dot active"></div>
              <div class="difficulty-dot"></div>
              <div class="difficulty-dot"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Study Controls -->
      <div class="study-controls">
        <div class="card-actions">
          <button class="btn" id="flipBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14.828 14.828a4 4 0 0 1-5.656 0M9 10h1M15 10h1M9 14h1M15 14h1"></path>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9Z"></path>
            </svg>
            Balik Kartu (Space)
          </button>

          <button class="btn" id="skipBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5,4 15,12 5,20"></polygon>
              <line x1="19" y1="5" x2="19" y2="19"></line>
            </svg>
            Lewati
          </button>

          <button class="btn btn-primary" id="startStudyBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5,3 19,12 5,21"></polygon>
            </svg>
            Mulai Belajar
          </button>
        </div>

        <!-- Rating Grid -->
        <div id="ratingSection" style="display: none;">
          <div class="rating-grid">
            <button class="rate-btn again" data-score="0">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              Lupa Banget
              <small>1 menit</small>
            </button>

            <button class="rate-btn hard" data-score="1">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path
                  d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z">
                </path>
              </svg>
              Susah
              <small>6 menit</small>
            </button>

            <button class="rate-btn good" data-score="2">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20,6 9,17 4,12"></polyline>
              </svg>
              Baik
              <small>10 menit</small>
            </button>

            <button class="rate-btn easy" data-score="3">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 19a4 4 0 0 1-4-4V9a4 4 0 0 1 4-4h1l3-3 3 3h1a4 4 0 0 1 4 4v6a4 4 0 0 1-4 4"></path>
                <circle cx="12" cy="12" r="2"></circle>
              </svg>
              Mudah Banget
              <small>4 hari</small>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script type="module">
    // Firebase Configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, where, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDlo2UFN0zO8oI9xDF3YKMeObKvA3poxns",
      authDomain: "nasa-a3871.firebaseapp.com",
      projectId: "nasa-a3871",
      storageBucket: "nasa-a3871.firebasestorage.app",
      messagingSenderId: "109624295870",
      appId: "1:109624295870:web:51070271ce74e2d63879ef"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Application State
    const STORAGE_KEY = 'vocabsr-enhanced:deck';
    const STATS_KEY = 'vocabsr-enhanced:stats';

    let deck = [];
    let studyQueue = [];
    let currentCard = null;
    let studySession = {
      startTime: null,
      cardsStudied: 0,
      correctAnswers: 0
    };

    let stats = {
      streak: 0,
      lastStudyDate: null,
      totalStudied: 0,
      dailyGoal: 20,
      achievements: []
    };

    // Utility Functions
    function todayDate() {
      const d = new Date();
      d.setHours(0, 0, 0, 0);
      return d.getTime();
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // Storage Functions
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(deck));
      localStorage.setItem(STATS_KEY, JSON.stringify(stats));
    }

    // ----- REPLACE loadData() -----
function loadData() {
  try {
    const deckData = localStorage.getItem(STORAGE_KEY);
    const statsData = localStorage.getItem(STATS_KEY);

    if (deckData) {
      const parsed = JSON.parse(deckData);
      if (Array.isArray(parsed)) {
        deck = parsed.map(card => ({
          ...card,
          id: card.id || Date.now() + Math.random(),
          interval: card.interval || 0,
          repetition: card.repetition || 0,
          ef: card.ef || 2.5,
          due: card.due || todayDate(),
          difficulty: card.difficulty || 3,
          history: card.history || []
        }));
      } else {
        console.warn('loadData: parsed deck is not an array, falling back to sample deck');
        initSampleDeck();
      }
    } else {
      initSampleDeck();
    }

    if (statsData) {
      try {
        const parsedStats = JSON.parse(statsData);
        if (parsedStats && typeof parsedStats === 'object') {
          stats = { ...stats, ...parsedStats };
        }
      } catch (e) {
        console.warn('loadData: invalid stats JSON, ignoring statsData');
      }
    }

    updateStreak();
  } catch (error) {
    console.error('Error loading data:', error);
    // Defensive fallback: coba initSampleDeck tapi protect jika itu juga error
    try {
      initSampleDeck();
    } catch (e) {
      console.error('initSampleDeck failed inside loadData catch:', e);
      deck = [];
      saveData();
    }
  }
}

// ----- REPLACE initSampleDeck() -----
function initSampleDeck() {
  const defaultSamples = [
    ['ask', 'bertanya'],
    ['answer', 'menjawab'],
    ['apple', 'apel']
  ];

  let samples = defaultSamples; // kalau nanti ambil dari sumber lain, validate dulu

  try {
    if (!Array.isArray(samples) || samples.length === 0) {
      samples = defaultSamples;
    }

    deck = (samples || []).map(([front, back], index) => ({
      id: Date.now() + index,
      front: front || '',
      back: back || '',
      interval: 0,
      repetition: 0,
      ef: 2.5,
      due: todayDate(),
      difficulty: 3,
      history: []
    }));

    saveData();
  } catch (err) {
    console.error('initSampleDeck fatal:', err);
    // guaranteed minimal fallback
    deck = defaultSamples.map(([front, back], index) => ({
      id: Date.now() + index,
      front,
      back,
      interval: 0,
      repetition: 0,
      ef: 2.5,
      due: todayDate(),
      difficulty: 3,
      history: []
    }));
    saveData();
  }
}



    // Enhanced SM-2 Algorithm
    function updateCardSM2(card, score) {
      const now = todayDate();

      // Record performance
      card.history.push({
        date: now,
        score: score,
        timeSpent: studySession.currentCardTime || 0
      });

      // Update difficulty based on performance
      if (score < 3) {
        card.difficulty = Math.min(5, card.difficulty + 1);
        card.repetition = 0;
        card.interval = 1;
        card.ef = Math.max(1.3, card.ef - 0.2);
      } else {
        card.difficulty = Math.max(1, card.difficulty - 0.1);

        if (card.repetition === 0) {
          card.interval = 1;
        } else if (card.repetition === 1) {
          card.interval = 6;
        } else {
          card.interval = Math.round(card.interval * card.ef);
        }

        card.repetition += 1;
        card.ef = Math.max(1.3, card.ef + (0.1 - (5 - score) * (0.08 + (5 - score) * 0.02)));
      }

      // Set next due date
      card.due = new Date(now + card.interval * 24 * 60 * 60 * 1000).getTime();

      // Update session stats
      studySession.cardsStudied++;
      if (score >= 2) studySession.correctAnswers++;

      // Save to Firestore
      saveCardToFirestore(card, score);
    }

    async function saveCardToFirestore(card, score) {
      try {
        await addDoc(collection(db, 'study_sessions'), {
          cardId: card.id,
          front: card.front,
          back: card.back,
          score: score,
          difficulty: card.difficulty,
          timestamp: Date.now(),
          interval: card.interval,
          ef: card.ef
        });
      } catch (error) {
        console.log('Offline mode - data saved locally');
      }
    }

    // Delete functions
    async function deleteCardFromFirestore(cardId, front, back) {
      try {
        // Query all documents with matching cardId or front+back combination
        const q1 = query(collection(db, 'study_sessions'), where('cardId', '==', cardId));
        const q2 = query(collection(db, 'study_sessions'), where('front', '==', front), where('back', '==', back));

        const [snapshot1, snapshot2] = await Promise.all([
          getDocs(q1),
          getDocs(q2)
        ]);

        const deletePromises = [];

        snapshot1.forEach((docSnapshot) => {
          deletePromises.push(deleteDoc(doc(db, 'study_sessions', docSnapshot.id)));
        });

        snapshot2.forEach((docSnapshot) => {
          deletePromises.push(deleteDoc(doc(db, 'study_sessions', docSnapshot.id)));
        });

        await Promise.all(deletePromises);
        console.log(`Deleted ${deletePromises.length} records from Firestore`);

        return deletePromises.length;
      } catch (error) {
        console.error('Error deleting from Firestore:', error);
        throw error;
      }
    }

    async function deleteCard(cardId) {
      const card = deck.find(c => c.id == cardId);
      if (!card) return;

      if (confirm(`Yakin ingin menghapus "${card.front}" - "${card.back}"?\nTindakan ini akan menghapus kata dari deck dan semua riwayat pembelajaran dari database.`)) {
        try {
          // Show loading state
          const deleteButtons = document.querySelectorAll(`button[data-delete="${cardId}"]`);
          deleteButtons.forEach(btn => {
            btn.disabled = true;
            btn.innerHTML = '<div style="width: 16px; height: 16px; border: 2px solid white; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>';
          });

          // Delete from Firestore first
          const deletedCount = await deleteCardFromFirestore(cardId, card.front, card.back);

          // Remove from local deck
          deck = deck.filter(c => c.id != cardId);
          saveData();
          updateStats();
          updateWordList();

          // Refresh review page if it's currently open
          if (document.getElementById('reviewPage').style.display !== 'none') {
            await renderReviewCategories();
          }

          showSuccess(`Berhasil menghapus "${card.front}" dari deck dan ${deletedCount} record dari database`);

        } catch (error) {
          console.error('Error deleting card:', error);
          showError('Gagal menghapus dari database, namun kata sudah dihapus dari deck lokal');

          // Still remove from local deck even if Firestore deletion failed
          deck = deck.filter(c => c.id != cardId);
          saveData();
          updateStats();
          updateWordList();

          if (document.getElementById('reviewPage').style.display !== 'none') {
            await renderReviewCategories();
          }
        }
      }
    }

    // Translation Functions
    async function autoTranslate(text, target = 'id', source = 'auto') {
      if (!text.trim()) return '';

      // 1) H56 API
      try {
        const h56Res = await fetch('https://h56-translator-api.netlify.app/api/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, targetLang: target })
        });
        if (h56Res.ok) {
          const data = await h56Res.json();
          const translated =
            data.translatedText ||
            data.translated_text ||
            data.translated ||
            data.result ||
            (data.data && (data.data.translatedText || data.data.translated_text));
          if (translated) return translated;
        }
      } catch (err) {
        console.warn('H56 error:', err);
      }

      // 2) LibreTranslate
      try {
        const libreRes = await fetch('https://libretranslate.de/translate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Accept: 'application/json'
          },
          body: JSON.stringify({ q: text, source: 'auto', target, format: 'text' })
        });
        if (libreRes.ok) {
          const data = await libreRes.json();
          if (data.translatedText) return data.translatedText;
        }
      } catch (err) {
        console.warn('Libre error:', err);
      }

      // 3) MyMemory fallback
      try {
        const res = await fetch(
          `https://api.mymemory.translated.net/get?q=${encodeURIComponent(
            text
          )}&langpair=auto|${target}`
        );
        if (res.ok) {
          const data = await res.json();
          if (data.responseData?.translatedText) return data.responseData.translatedText;
        }
      } catch (err) {
        console.warn('MyMemory error:', err);
      }

      return 'Gagal menerjemahkan';
    }


    const inputEl = document.getElementById('translateInput');
    const outputEl = document.getElementById('translateOutput');
    const directionEl = document.getElementById('translateDirection');

    let typingTimer;
    inputEl.addEventListener('input', () => {
      clearTimeout(typingTimer);
      typingTimer = setTimeout(async () => {
        const text = inputEl.value.trim();
        if (!text) {
          outputEl.value = '';
          return;
        }

        // ambil arah terjemahan
        const [source, target] = directionEl.value.split('|');

        outputEl.value = 'Menerjemahkan...';
        try {
          const result = await autoTranslate(text, target, source);
          outputEl.value = result;
        } catch (e) {
          outputEl.value = 'Terjadi error';
          console.error(e);
        }
      }, 600);
    });




    // Study Functions
    function buildStudyQueue() {
      const today = todayDate();
      studyQueue = deck
        .map((card, index) => ({ ...card, originalIndex: index }))
        .filter(card => card.due <= today)
        .sort((a, b) => a.due - b.due);

      // Shuffle new cards
      const newCards = studyQueue.filter(card => card.repetition === 0);
      const reviewCards = studyQueue.filter(card => card.repetition > 0);

      // Fisher-Yates shuffle for new cards
      for (let i = newCards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newCards[i], newCards[j]] = [newCards[j], newCards[i]];
      }

      studyQueue = [...reviewCards, ...newCards];
    }

    function getNextCard() {
      if (studyQueue.length === 0) {
        buildStudyQueue();
        if (studyQueue.length === 0) {
          return null;
        }
      }

      const cardData = studyQueue.shift();
      return deck[cardData.originalIndex];
    }

    function startStudySession() {
      studySession = {
        startTime: Date.now(),
        cardsStudied: 0,
        correctAnswers: 0,
        currentCardTime: 0
      };

      buildStudyQueue();
      showNextCard();
      startTimer();

      // Show rating section
      document.getElementById('ratingSection').style.display = 'block';
      document.getElementById('startStudyBtn').style.display = 'none';
    }

    let autoFlipInterval = null;

    function startAutoFlip() {
      // bersihin interval lama kalau ada
      if (autoFlipInterval) clearInterval(autoFlipInterval);

      autoFlipInterval = setInterval(() => {
        if (!currentCard) return;
        flipCard(); // fungsi flipCard() udah ada di kode lo
      }, 2000); // 3 detik sekali
    }

    function stopAutoFlip() {
      if (autoFlipInterval) {
        clearInterval(autoFlipInterval);
        autoFlipInterval = null;
      }
    }


    function showNextCard() {
      currentCard = getNextCard();

      if (!currentCard) {
        endStudySession();
        return;
      }

      const card = document.getElementById('studyCard');
      card.classList.remove('flipped');

      document.getElementById('frontText').textContent = currentCard.front;
      document.getElementById('backText').textContent = currentCard.front;
      document.getElementById('backTranslation').textContent = currentCard.back;

      updateDifficultyIndicators();

      card.classList.add('animate-in');
      setTimeout(() => card.classList.remove('animate-in'), 500);

      studySession.currentCardTime = Date.now();

      // auto flip jalan lagi tiap kali kartu baru muncul
      startAutoFlip();
    }


    function updateDifficultyIndicators() {
      const frontDots = document.querySelectorAll('.card-front .difficulty-dot');
      const backDots = document.querySelectorAll('.card-back .difficulty-dot');

      [frontDots, backDots].forEach(dots => {
        dots.forEach((dot, index) => {
          dot.classList.toggle('active', index < currentCard.difficulty);
        });
      });
    }

    function flipCard() {
      if (!currentCard) return;

      const card = document.getElementById('studyCard');
      card.classList.toggle('flipped');
    }

    function rateCard(score) {
      if (!currentCard) return;

      // Calculate time spent on this card
      if (studySession.currentCardTime) {
        studySession.currentCardTime = Date.now() - studySession.currentCardTime;
      }

      updateCardSM2(currentCard, score);
      saveData();
      updateStats();

      // Show next card after a brief delay
      setTimeout(() => {
        showNextCard();
      }, 300);
    }

    function skipCard() {
      if (!currentCard) return;

      // Put card back at end of queue
      studyQueue.push({ ...currentCard, originalIndex: deck.indexOf(currentCard) });
      showNextCard();
    }

    function endStudySession() {
      document.getElementById('frontText').textContent = 'Sesi Selesai!';
      document.getElementById('backText').textContent = 'Selamat!';
      document.getElementById('backTranslation').textContent = `${studySession.cardsStudied} kartu dipelajari`;

      document.getElementById('ratingSection').style.display = 'none';
      document.getElementById('startStudyBtn').style.display = 'inline-flex';

      // Update daily progress
      updateDailyProgress();

      // Check for achievements
      checkAchievements();

      // Reset study session
      studySession = { startTime: null, cardsStudied: 0, correctAnswers: 0 };
    }

    // Statistics Functions
    function updateStats() {
      updateCardCounts();
      updateStreakDisplay();
      updateDailyProgress();
    }

    function updateCardCounts() {
      const today = todayDate();

      document.getElementById('totalCards').textContent = deck.length;
      document.getElementById('dueCards').textContent = deck.filter(c => c.due <= today).length;
      document.getElementById('newCards').textContent = deck.filter(c => c.repetition === 0).length;
      document.getElementById('studiedCards').textContent = deck.filter(c => c.history && c.history.length > 0).length;
    }

    function updateStreak() {
      const today = todayDate();
      const yesterday = today - 24 * 60 * 60 * 1000;

      if (stats.lastStudyDate === today) {
        // Already studied today
        return;
      } else if (stats.lastStudyDate === yesterday) {
        // Studied yesterday, continue streak
        stats.streak += 1;
        stats.lastStudyDate = today;
      } else if (stats.lastStudyDate && stats.lastStudyDate < yesterday) {
        // Missed a day, reset streak
        stats.streak = 1;
        stats.lastStudyDate = today;
      } else if (!stats.lastStudyDate) {
        // First time studying
        stats.streak = 1;
        stats.lastStudyDate = today;
      }

      saveData();
    }

    function updateStreakDisplay() {
      document.getElementById('streakCount').textContent = stats.streak;
    }

    function updateDailyProgress() {
      const todayStudied = deck.filter(card =>
        card.history &&
        card.history.some(h => h.date === todayDate())
      ).length;

      const progress = Math.min(100, (todayStudied / stats.dailyGoal) * 100);
      document.getElementById('dailyProgress').style.width = `${progress}%`;
    }

    function checkAchievements() {
      const achievements = [
        { id: 'streak7', days: 7, element: 'badge1' },
        { id: 'words50', count: 50, element: 'badge2' },
        { id: 'accuracy90', accuracy: 0.9, element: 'badge3' },
        { id: 'streak30', days: 30, element: 'badge4' }
      ];

      achievements.forEach(achievement => {
        const element = document.getElementById(achievement.element);
        let earned = false;

        if (achievement.days && stats.streak >= achievement.days) {
          earned = true;
        } else if (achievement.count && deck.length >= achievement.count) {
          earned = true;
        } else if (achievement.accuracy) {
          const totalSessions = studySession.cardsStudied;
          const accuracy = totalSessions > 0 ? studySession.correctAnswers / totalSessions : 0;
          if (accuracy >= achievement.accuracy) {
            earned = true;
          }
        }

        if (earned && !stats.achievements.includes(achievement.id)) {
          element.classList.remove('locked');
          element.classList.add('earned');
          stats.achievements.push(achievement.id);
          showAchievementNotification(achievement);
        } else if (earned) {
          element.classList.remove('locked');
          element.classList.add('earned');
        }
      });

      saveData();
    }

    function showAchievementNotification(achievement) {
      // Simple achievement notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
        color: white;
        padding: 20px 30px;
        border-radius: 15px;
        box-shadow: var(--shadow-lg);
        z-index: 10000;
        font-weight: 600;
        text-align: center;
        animation: slideInUp 0.5s ease;
      `;
      notification.innerHTML = `
        <div style="font-size: 24px; margin-bottom: 10px;">🏆</div>
        <div>Achievement Unlocked!</div>
      `;

      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Timer Functions
    let timerInterval;
    let elapsedSeconds = 0;

    function startTimer() {
      elapsedSeconds = 0;
      timerInterval = setInterval(() => {
        elapsedSeconds++;
        document.getElementById('studyTimer').textContent = formatTime(elapsedSeconds);
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // Review Functions
    async function showReviewPage() {
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('grammarPage').style.display = 'none';
      document.getElementById('reviewPage').style.display = 'block';

      // Close sidebar
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('active');

      await renderReviewCategories();
    }

    function showGrammarPage() {
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('reviewPage').style.display = 'none';
      document.getElementById('grammarPage').style.display = 'block';

      // Tutup sidebar kalau kebuka
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('active');
    }

    function showMainPage() {
      document.getElementById('reviewPage').style.display = 'none';
      document.getElementById('grammarPage').style.display = 'none';
      document.getElementById('mainApp').style.display = 'block';
    }


    async function renderReviewCategories() {
      const categoriesEl = document.getElementById('reviewCategories');
      categoriesEl.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">Memuat data review...</div>';

      try {
        // Get all reviews from Firestore
        const snapshot = await getDocs(collection(db, 'study_sessions'));
        const allReviews = snapshot.docs.map(doc => doc.data());

        // Create a map to get the latest review for each card
        const latestReviewMap = new Map();
        allReviews.forEach(review => {
          const key = `${review.front}|${review.back}`;
          if (!latestReviewMap.has(key) || review.timestamp > latestReviewMap.get(key).timestamp) {
            latestReviewMap.set(key, review);
          }
        });

        const uniqueReviews = Array.from(latestReviewMap.values());

        // Categorize by score
        const categories = {
          lupa: { items: [], color: 'var(--accent-red)', name: 'Lupa Banget' },
          susah: { items: [], color: 'var(--accent-orange)', name: 'Susah' },
          baik: { items: [], color: 'var(--accent-green)', name: 'Baik' },
          mudah: { items: [], color: 'var(--accent-blue)', name: 'Mudah Banget' }
        };

        uniqueReviews.forEach(review => {
          // Find matching card in deck to get the ID
          const matchingCard = deck.find(card =>
            card.front === review.front && card.back === review.back
          );

          const reviewItem = {
            ...review,
            localCardId: matchingCard ? matchingCard.id : null
          };

          if (review.score === 0) categories.lupa.items.push(reviewItem);
          else if (review.score === 1) categories.susah.items.push(reviewItem);
          else if (review.score === 2) categories.baik.items.push(reviewItem);
          else if (review.score === 3) categories.mudah.items.push(reviewItem);
        });

        // Clear loading message
        categoriesEl.innerHTML = '';

        // Render categories
        Object.keys(categories).forEach(categoryKey => {
          const category = categories[categoryKey];
          const categoryEl = document.createElement('div');
          categoryEl.className = `review-category category-${categoryKey}`;

          categoryEl.innerHTML = `
            <h3 style="color: ${category.color};">
              ${category.name}
              <span class="count-badge">${category.items.length}</span>
            </h3>
            <div class="category-items"></div>
          `;

          const itemsContainer = categoryEl.querySelector('.category-items');

          if (category.items.length === 0) {
            itemsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted); font-style: italic;">Tidak ada kosakata</div>';
          } else {
            category.items.forEach(item => {
              const itemEl = document.createElement('div');
              itemEl.className = 'review-item';

              itemEl.innerHTML = `
                <div class="review-item-content">
                  <div class="word">${item.front}</div>
                  <div class="translation">${item.back}</div>
                </div>
                <div class="review-item-actions">
                  ${item.localCardId ? `
                    <button class="delete-btn" data-delete="${item.localCardId}" title="Hapus kata ini">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      </svg>
                    </button>
                  ` : `
                    <span style="font-size: 12px; color: var(--text-muted); font-style: italic;">Tidak ada di deck lokal</span>
                  `}
                </div>
              `;

              itemsContainer.appendChild(itemEl);
            });
          }

          categoriesEl.appendChild(categoryEl);
        });

        // Add event listeners for delete buttons
        categoriesEl.addEventListener('click', async (e) => {
          const deleteBtn = e.target.closest('button[data-delete]');
          if (deleteBtn) {
            const cardId = deleteBtn.dataset.delete;
            await deleteCard(cardId);
          }
        });

      } catch (error) {
        console.error('Error loading review data:', error);
        categoriesEl.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <div style="color: var(--accent-red); margin-bottom: 10px;">Gagal memuat data review</div>
            <div style="color: var(--text-muted); font-size: 14px;">Pastikan koneksi internet stabil</div>
          </div>
        `;
      }
    }
    async function addWord() {
      const input = document.getElementById('wordInput');
      const word = input.value.trim();

      if (!word) return;

      try {
        showError('');
        setLoading(true);

        let front, back;

        if (word.includes(',')) {
          // Manual format: word,translation
          [front, back] = word.split(',').map(s => s.trim());
          if (!front || !back) {
            throw new Error('Format: kata,terjemahan (contoh: hello,halo)');
          }
        } else {
          // Auto translate
          front = word;
          back = await translateWord(word);
        }

        // Check if word already exists
        if (deck.find(card => card.front.toLowerCase() === front.toLowerCase())) {
          throw new Error('Kata sudah ada dalam deck');
        }

        // Add new card
        const newCard = {
          id: Date.now() + Math.random(),
          front: front,
          back: back,
          interval: 0,
          repetition: 0,
          ef: 2.5,
          due: todayDate(),
          difficulty: 3,
          history: []
        };

        deck.push(newCard);
        saveData();
        updateStats();
        updateWordList();

        input.value = '';
        showSuccess(`Berhasil menambahkan: ${front} - ${back}`);

      } catch (error) {
        showError(error.message);
      } finally {
        setLoading(false);
      }
    }

    function setLoading(loading) {
      const btn = document.getElementById('addWordBtn');
      const input = document.getElementById('wordInput');

      btn.disabled = loading;
      input.disabled = loading;
      btn.textContent = loading ? 'Menerjemahkan...' : 'Tambah Kata';
    }

    function showError(message) {
      const errorEl = document.getElementById('errorMessage');
      if (message) {
        errorEl.textContent = message;
        errorEl.style.display = 'block';
      } else {
        errorEl.style.display = 'none';
      }
    }

    function showSuccess(message) {
      // Simple success notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, var(--accent-green), #059669);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        z-index: 10000;
        animation: slideInUp 0.3s ease;
      `;
      notification.textContent = message;

      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    function updateWordList(searchTerm = '') {
      const container = document.getElementById('wordList');
      container.innerHTML = '';

      const filtered = deck.filter(card =>
        !searchTerm ||
        card.front.toLowerCase().includes(searchTerm.toLowerCase()) ||
        card.back.toLowerCase().includes(searchTerm.toLowerCase())
      );

      if (filtered.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted);">Tidak ada kata yang ditemukan</div>';
        return;
      }

      filtered.forEach(card => {
        const item = document.createElement('div');
        item.className = 'list-item';
        item.innerHTML = `
          <div>
            <div style="font-weight: 600; margin-bottom: 5px;">${card.front}</div>
            <div style="color: var(--text-secondary); font-size: 14px;">${card.back}</div>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn" data-study="${card.id}" style="padding: 8px 12px; font-size: 12px;">
              Study
            </button>
            <button class="btn" data-remove="${card.id}" style="padding: 8px 12px; font-size: 12px; background: var(--accent-red); color: white; border: none;">
              ×
            </button>
          </div>
        `;

        container.appendChild(item);
      });
    }

    // Import/Export Functions
    function importCSV(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const text = e.target.result;
          const lines = text.split('\n').filter(line => line.trim());

          let imported = 0;
          lines.forEach((line, index) => {
            const [front, back] = line.split(',').map(s => s.trim());
            if (front && back) {
              const newCard = {
                id: Date.now() + index,
                front: front,
                back: back,
                interval: 0,
                repetition: 0,
                ef: 2.5,
                due: todayDate(),
                difficulty: 3,
                history: []
              };

              // Check if word doesn't already exist
              if (!deck.find(card => card.front.toLowerCase() === front.toLowerCase())) {
                deck.push(newCard);
                imported++;
              }
            }
          });

          saveData();
          updateStats();
          updateWordList();

          showSuccess(`Berhasil mengimpor ${imported} kata!`);
        } catch (error) {
          showError('Gagal mengimpor file CSV');
        }
      };

      reader.readAsText(file);
    }

    function exportCSV() {
      const csvContent = deck.map(card => `${card.front},${card.back}`).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'vocabsr-deck.csv';
      a.click();

      URL.revokeObjectURL(url);
    }

    function resetData() {
      if (confirm('Yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(STATS_KEY);
        location.reload();
      }
    }

    // Theme Functions
    function toggleTheme() {
      document.body.classList.toggle('light-theme');
      // You can implement light theme styles if needed
    }

    // Event Listeners
    function setupEventListeners() {
      // Sidebar
      document.getElementById('sidebarToggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('sidebarOverlay').classList.toggle('active');
      });

      document.getElementById('sidebarOverlay').addEventListener('click', () => {
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('sidebarOverlay').classList.remove('active');
      });

      // Word management
      document.getElementById('addWordBtn').addEventListener('click', addWord);
      document.getElementById('wordInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addWord();
      });

      // Search
      document.getElementById('search').addEventListener('input', (e) => {
        updateWordList(e.target.value);
      });

      // Study controls
      document.getElementById('startStudyBtn').addEventListener('click', startStudySession);
      document.getElementById('flipBtn').addEventListener('click', flipCard);
      document.getElementById('skipBtn').addEventListener('click', skipCard);

      // Rating buttons
      document.querySelectorAll('.rate-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const score = parseInt(btn.dataset.score);
          rateCard(score);
        });
      });

      // Word list actions
      document.getElementById('wordList').addEventListener('click', (e) => {
        if (e.target.dataset.study) {
          const cardId = e.target.dataset.study;
          const card = deck.find(c => c.id == cardId);
          if (card) {
            currentCard = card;
            showNextCard();
            startStudySession();
            // Close sidebar
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('active');
          }
        } else if (e.target.dataset.remove) {
          const cardId = e.target.dataset.remove;
          if (confirm('Hapus kata ini?')) {
            deck = deck.filter(c => c.id != cardId);
            saveData();
            updateStats();
            updateWordList();
          }
        }
      });

      // File operations
      document.getElementById('fileInput').addEventListener('change', (e) => {
        if (e.target.files[0]) {
          importCSV(e.target.files[0]);
        }
      });

      document.getElementById('exportBtn').addEventListener('click', exportCSV);
      document.getElementById('resetBtn').addEventListener('click', resetData);
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);

      // Review page navigation
      document.getElementById('reviewBtn').addEventListener('click', showReviewPage);
      document.getElementById('backToMainBtn').addEventListener('click', showMainPage);
      document.getElementById("grammarBtn").addEventListener("click", showGrammarPage);

      // Grammar → Balik ke Main
      document.getElementById("backToMainFromGrammar").addEventListener("click", showMainPage);

      // Review → Balik ke Main
      document.getElementById("backToMainBtn").addEventListener("click", showMainPage);

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (currentCard && document.getElementById('ratingSection').style.display !== 'none') {
          switch (e.key) {
            case ' ':
              e.preventDefault();
              flipCard();
              break;
            case '1':
              rateCard(0);
              break;
            case '2':
              rateCard(1);
              break;
            case '3':
              rateCard(2);
              break;
            case '4':
              rateCard(3);
              break;
          }
        }
      });
    }

    // Initialize Application
    function initialize() {
      loadData();
      updateStats();
      updateWordList();
      setupEventListeners();

      // Add some animations on load
      setTimeout(() => {
        document.querySelectorAll('.animate-in').forEach((el, index) => {
          el.style.animationDelay = `${index * 0.1}s`;
        });
      }, 100);
    }

    // Start the application
    initialize();
  </script>
</body>

</html>